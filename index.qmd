---
title: "Montana"
format: html
editor: visual
---

# Montana Map Test

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(tigris)
library(sf)
library(ggplot2)
library(dplyr)
library(tidycensus)
library(htmltools)
library(janitor)
library(here)
library(mapview)
library(leafsync)
library(leaflet.extras2)
options(tigris_class = "sf")

```

```{r, include=FALSE}
myapikey <- "7ec164ce2e6d7eff05a3da72fa85dec41773e398"
census_api_key(myapikey, overwrite = TRUE)
```

## Census Data

```{r, include=FALSE}
montana_income <- get_acs(
  geography = 'tract',
  variables = c( 
    median_income = 'B06011_001'
  ),
  state = 'MT',
  output = "wide",
  geometry = TRUE
)
```

```{r, include=FALSE}
montana_income <- montana_income %>%
  select(-ends_with("M"))

colnames(montana_income) <- sub("E$", "", colnames(montana_income))
```

```{r}
mapview(montana_income, zcol = "median_income")
```

## Harvard Data

```{r}
# Define the path to the ZIP file
zip_file_path <- "/mnt/data/X2018_mt_precinct_general.zip"
unzip_dir <- tempdir()  # Temporary directory to extract the files

# Unzip the file and list the contents
unzip(zip_file_path, exdir = unzip_dir)
files_in_zip <- list.files(unzip_dir)
print(files_in_zip)  # Print the files to verify contents

# Identify the shapefile
shapefile_path <- list.files(unzip_dir, pattern = "\\.shp$", full.names = TRUE)

if (length(shapefile_path) == 0) {
  stop("No shapefile found in the ZIP archive.")
}

# Read the shapefile
data_sf <- st_read(shapefile_path[1])

# Plot the map using ggplot2
ggplot() +
  geom_sf(data = data_sf, fill = "lightblue", color = "darkblue") +
  theme_minimal() +
  labs(title = "Montana Precincts - 2018 General",
       x = "Longitude", y = "Latitude")
```
